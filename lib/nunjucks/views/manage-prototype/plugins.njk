{% extends "views/manage-prototype/layout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/label/macro.njk" import govukLabel %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/tag/macro.njk" import govukTag %}

{% block content %}
    <div class="govuk-grid-row govuk-!-margin-bottom-5">
        <div class="govuk-grid-column-two-thirds-from-desktop">
            <h1 class="govuk-heading-l">Plugins</h1>
            <p class="govuk-body">
                Plugins provide you with new components, styles and other features
            </p>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-quarter">
            {% if isSearchPage %}
                <div class="sub-nav govuk-!-margin-bottom-6 govuk-prototype-kit-manage-prototype-plugin-subnav--current">
                    <h2 class="govuk-heading-m">Find plugins</h2>
                </div>
                <div class="sub-nav">
                    <a id="installed-plugins-link" href="./plugins-installed"
                       class="govuk-heading-m govuk-link--no-visited-state">
                        Installed plugins
                    </a>
                </div>
            {% else %}
                <div class="sub-nav govuk-!-margin-bottom-6">
                    <a id="available-plugins-link" href="./plugins"
                       class="govuk-heading-m govuk-link--no-visited-state">
                        Find plugins
                    </a>
                </div>
                <div class="sub-nav govuk-prototype-kit-manage-prototype-plugin-subnav--current">
                    <h2 class="govuk-heading-m">Installed plugins</h2>
                </div>
            {% endif %}
            {% if updatesMessage %}
                {{ govukTag({
                    attributes: {id: "plugins-updates-available-message"},text: updatesMessage
                }) }}
            {% endif %}
        </div>

        <div class="govuk-grid-column-three-quarters">
            {% if isSearchPage %}
                <div class="govuk-!-margin-bottom-5">
                    <div id="search-container">
                        {{ govukLabel({
                            text:"Search",
                            classes:"govuk-!-font-weight-bold"
                        }) }}

                        {{ govukInput({
                            id: "search",
                            classes: "govuk-!-width-one-half",
                            formGroup: {
                                classes: "govuk-!-margin-bottom-3"
                            },
                            name: "search",
                            value: search
                        }) }}

                        <div class="govuk-button-group">
                            {{ govukButton({
                                text: "Search",
                                classes: "govuk-button--secondary",
                                attributes: { id: "search-button", formaction: "#" }
                            }) }}

                            {% if search %}
                                <a class="govuk-link govuk-link--no-visited-state" href="?">Clear search</a>
                            {% endif %}
                        </div>
                    </div>
                    <h3 class="govuk-body govuk-!-font-weight-bold">
                        {{ foundMessage }}
                    </h3>
                </div>
            {% endif %}

            <ul class="govuk-list govuk-prototype-kit-manage-prototype-plugin-list-plugin-list"
                data-plugin-group-status="{{ status }}">
                {% for plugin in plugins %}
                    <li class="govuk-prototype-kit-manage-prototype-plugin-list-plugin-list__item"
                        data-plugin-package-name="{{ plugin.packageName }}">

                        <div class="govuk-grid-column-one-third govuk-body">
                            <a id="plugin-details-link" href="./plugin-details?package={{ plugin.packageName }}"
                               class="govuk-heading-s govuk-link--no-visited-state">
                                {{ plugin.name }}
                            </a>
                            {% if plugin.scope %}
                                <div>
                                    By {{ plugin.scope }}
                                </div>
                            {% endif %}
                            {% if plugin.installedVersion %}
                                <div class="govuk-!-margin-top-3">
                                    version {{ plugin.installedVersion }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="govuk-grid-column-two-thirds govuk-body">
                            <div id="plugin-installed-status">
                                {% if plugin.updateLink %}
                                    <p>
                                        {{ govukTag({
                                            text: "Update available"
                                        }) }}
                                    </p>
                                {% elseif isSearchPage and plugin.installedVersion %}
                                    <p>
                                        {{ govukTag({
                                            text: "Installed",
                                            classes: "govuk-tag--grey"
                                        }) }}
                                    </p>
                                {% endif %}
                            </div>
                            {% if plugin.description %}
                                <div class="govuk-!-margin-bottom-3">
                                    {{ plugin.description }}
                                </div>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endblock %}
